<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Client with Protobuf</title>
    <script src="https://cdn.jsdelivr.net/npm/protobufjs@7.2.5/dist/protobuf.min.js"></script>
  </head>
  <body>
    <script>
      let ws = null;
      let MyMessage = null;
      protobuf.load("./_shared/protobufs/message.proto", function (err, root) {
        if (err) throw err;

        MyMessage = root.lookupType("Message");

        // Connect to the WebSocket server
        ws = new WebSocket("ws://127.0.0.1:3000");
        ws.binaryType = "arraybuffer";

        ws.onopen = () => {
          // Send a message once connected
          const payload = { content: "Hello from the browser!" };
          const buffer = MyMessage.encode(payload).finish();
          ws.send(buffer);
        };

        ws.onmessage = (event) => {
          const arrayBuffer = event.data;
          const uint8Array = new Uint8Array(arrayBuffer);
          const decoded = MyMessage.decode(uint8Array);
          console.log(`Received: ${decoded.content}`);
        };
      });
    </script>
  </body>
</html>
